# 折线图和散点图

## 散点图

使用`px.scatter`就可以绘制散点图，我们只需要提供`plotly`可接收`x`和`y`即可。

```py
# 接收数组
import plotly.express as px
fig = px.scatter(
    x = [0, 1, 2, 3, 4],
    y = [0, 1, 4, 9, 16]
)
fig.show()
```

```py
# 接收DataFrame
import plotly.express as px
df = px.data.iris()
fig = px.scatter(
    df,
    x = "sepal_width",
    y = "sepal_length"
)
fig.show()
```

### 通过列名设定散点图的样式

对于散点图里的点，我们有时需要其呈现更多的样式，例如散点图里的圆点变为不同大小的圆点就成了泡泡图。我们可以通过设定`color`和`size`来实现这个要求。此外，我们如果添加其他列的数据给`px.scatter`的`hover_data`参数，那么这些点在呈现悬停信息时也会呈现我们添加给`hover_data`的信息。

```py
import plotly.express as px
df = px.data.iris()
fig = px.scatter(
    df,
    x = "sepal_width",
    y = "sepal_length",
    color = "species",
    size = "petal_length",
    hover_data = ["petal_width"]
)
fig.show()
```

颜色即可以如下那样是[连续颜色](https://plotly.com/python/colorscales/)，也可以如上那样是[分离/多样](https://plotly.com/python/discrete-color/)。

```py
import plotly.express as px
df = px.data.iris()
fig = px.scatter(
    df,
    x = "sepal_width",
    y = "sepal_length",
    color = "petal_length"
)
fig.show()
```

`symbol`参数也可以用来映射一个列的数据。有众多种类的符号可供使用。

```py
import plotly.express as px
df = px.data.iris()
fig = px.scatter(
    df,
    x = "sepal_width",
    y = "sepal_length",
    color = "species",
    symbol = "species"
)
fig.show()
```

### 散点图和分类轴

可以使用任何类型的笛卡尔轴（包括线性轴、对数轴、分类轴或日期轴）绘制散点图。

一个轴为分类轴的散点图通常称为点图。

```py
import plotly.express as px
df = px.data.medals_long()

fig = px.scatter(
    df,
    y="nation",
    x="count",
    color="medal",
    symbol="medal"
)
fig.update_traces(marker_size=10)
fig.show()
```

### 误差线

散点图支持误差线。

```py
import plotly.express as px
df = px.data.iris()
df["e"] = df["sepal_width"]/100
fig = px.scatter(
    df,
    x="sepal_width",
    y="sepal_length",
    color="species",
    error_x="e",
    error_y="e"
)
fig.show()
```

### 边缘分布图

散点图支持边缘分布图。

```py
import plotly.express as px
df = px.data.iris()
fig = px.scatter(
    df,
    x="sepal_length",
    y="sepal_width",
    marginal_x="histogram",
    marginal_y="rug"
)
fig.show()
```

### 分面图

散点图支持分面图。

```py
import plotly.express as px
df = px.data.tips()
fig = px.scatter(
    df,
    x="total_bill",
    y="tip",
    color="smoker",
    facet_col="sex",
    facet_row="time"
)
fig.show()
```

### 线性回归和其他趋势线

散点图支持线性和非线性趋势线。

```py
import plotly.express as px
df = px.data.tips()
fig = px.scatter(
    df,
    x="total_bill",
    y="tip",
    trendline="ols"
)
fig.show()
```

## 折线图

```py
import plotly.express as px
import numpy as np

t = np.linspace(0, 2*np.pi, 100)

fig = px.line(
    x=t,
    y=np.cos(t),
    labels={'x':'t', 'y':'cos(t)'}
)
fig.show()
```

```py
import plotly.express as px
df = px.data.gapminder().query("continent == 'Oceania'")
fig = px.line(
    df,
    x='year',
    y='lifeExp',
    color='country'
)
fig.show()
```

将`markers`参数设定为`True`就可以在行上显示标记。

```py
import plotly.express as px
df = px.data.gapminder().query("continent == 'Oceania'")
fig = px.line(
    df,
    x='year',
    y='lifeExp',
    color='country',
    markers=True
)
fig.show()
```

`symbol`参数也可以用来将数据字段映射到标记符号。有众多种类的符号可供使用。

```py
import plotly.express as px
df = px.data.gapminder().query("continent == 'Oceania'")
fig = px.line(
    df,
    x='year',
    y='lifeExp',
    color='country',
    symbol="country"
)
fig.show()
```

### 在日期轴上绘制折线图

可以使用任何类型的笛卡尔轴（包括线性轴、对数轴、分类轴或日期轴）绘制折线图。在日期轴上的折线图通常被称为时间序列图。

当相应的数据是iso格式的日期字符串，或者是date pandas列或datetime NumPy数组时，Plotly自动将轴类型设置为日期格式。

```py
import plotly.express as px

df = px.data.stocks()
fig = px.line(
    df,
    x='date',
    y="GOOG"
)
fig.show()
```

### 散点图和折线图中的数据顺序

Plotly折线图以连接散点图（见下文）的形式实现，这意味着点是**按照提供的顺序绘制和连接的，不会自动重新排序**。

这使得可以制作如下图所示的图表，但也意味着在将数据传递给Plotly之前，可能需要显式地对数据进行排序，以避免线在图表上“向后”移动。

```py
import plotly.express as px
import pandas as pd

df = pd.DataFrame(dict(
    x = [1, 3, 2, 4],
    y = [1, 2, 3, 4]
))
fig = px.line(df, x="x", y="y", title="Unsorted Input") 
fig.show()

df = df.sort_values(by="x")
fig = px.line(df, x="x", y="y", title="Sorted Input") 
fig.show()
```

### 连通散点图

在连通散点图中，两个连续变量被绘制在一起，用一条线将它们按某种有意义的顺序连接起来，通常是时间变量。在下面的图表中，我们展示了两个国家在一个由人均GDP和预期寿命定义的空间中的“轨迹”。

## 使用go.Scatter进行散点图和折线图的绘制

如果Plotly Express不能提供一个良好的起点，可以使用`plotly.graph_objects`中更通用的`go.Scatter`类。

尽管`plotly.express`有`scatter`和`line`两个函数，然而`go.Scatter`是用来绘制点（标记）还是线则取决与`mode`参数的值。对于`go.Scatter`的不同选项则记录在参考页中。

### 简单散点图

```py
import plotly.graph_objects as go
import numpy as np

N = 1000
t = np.linspace(0, 10, 100)
y = np.sin(t)

fig = go.Figure(
    data=go.Scatter(
        x=t, 
        y=y, 
        mode='markers'
    )
)

fig.show()
```

### 折线和散点图

使用`mode`参数在标记和线之间进行选择，或者两者兼有。对于折线图的更多选项可见[line charts notebook](https://plotly.com/python/line-charts/)和[filled area plots notebook](https://plotly.com/python/filled-area-plots/)。

```py
import plotly.graph_objects as go

# Create random data with numpy
import numpy as np
np.random.seed(1)

N = 100
random_x = np.linspace(0, 1, N)
random_y0 = np.random.randn(N) + 5
random_y1 = np.random.randn(N)
random_y2 = np.random.randn(N) - 5

fig = go.Figure()

# Add traces
fig.add_trace(go.Scatter(x=random_x, y=random_y0,
                    mode='markers',
                    name='markers'))
fig.add_trace(go.Scatter(x=random_x, y=random_y1,
                    mode='lines+markers',
                    name='lines+markers'))
fig.add_trace(go.Scatter(x=random_x, y=random_y2,
                    mode='lines',
                    name='lines'))

fig.show()
```

### 气泡散点图

在气泡图中，数据的第三个维度是通过标记的大小来显示的。更多的例子，请参阅[bubble chart notebook](https://plotly.com/python/bubble-charts/)。

```py
import plotly.graph_objects as go

fig = go.Figure(data=go.Scatter(
    x=[1, 2, 3, 4],
    y=[10, 11, 12, 13],
    mode='markers',
    marker=dict(size=[40, 60, 80, 100],
                color=[0, 1, 2, 3])
))

fig.show()
```

### 风格散点图

```py
import plotly.graph_objects as go
import numpy as np


t = np.linspace(0, 10, 100)

fig = go.Figure()

fig.add_trace(go.Scatter(
    x=t, y=np.sin(t),
    name='sin',
    mode='markers',
    marker_color='rgba(152, 0, 0, .8)'
))

fig.add_trace(go.Scatter(
    x=t, y=np.cos(t),
    name='cos',
    marker_color='rgba(255, 182, 193, .9)'
))

# Set options common to all traces with fig.update_traces
fig.update_traces(mode='markers', marker_line_width=2, marker_size=10)
fig.update_layout(title='Styled Scatter',
                  yaxis_zeroline=False, xaxis_zeroline=False)


fig.show()
```

### 悬停时的数据标签

```py
import plotly.graph_objects as go
import pandas as pd

data= pd.read_csv("https://raw.githubusercontent.com/plotly/datasets/master/2014_usa_states.csv")

fig = go.Figure(data=go.Scatter(x=data['Postal'],
                                y=data['Population'],
                                mode='markers',
                                marker_color=data['Population'],
                                text=data['State'])) # hover text goes here

fig.update_layout(title='Population of USA States')
fig.show()
```

### 带颜色维度的散点

```py
import plotly.graph_objects as go
import numpy as np

fig = go.Figure(data=go.Scatter(
    y = np.random.randn(500),
    mode='markers',
    marker=dict(
        size=16,
        color=np.random.randn(500), #set color equal to a variable
        colorscale='Viridis', # one of plotly colorscales
        showscale=True
    )
))

fig.show()
```

### 大数据集

```py
import plotly.graph_objects as go
import numpy as np

N = 100000
fig = go.Figure(data=go.Scattergl(
    x = np.random.randn(N),
    y = np.random.randn(N),
    mode='markers',
    marker=dict(
        color=np.random.randn(N),
        colorscale='Viridis',
        line_width=1
    )
))

fig.show()
```

```py
import plotly.graph_objects as go
import numpy as np

N = 100000
r = np.random.uniform(0, 1, N)
theta = np.random.uniform(0, 2*np.pi, N)

fig = go.Figure(data=go.Scattergl(
    x = r * np.cos(theta), # non-uniform distribution
    y = r * np.sin(theta), # zoom to see more points at the center
    mode='markers',
    marker=dict(
        color=np.random.randn(N),
        colorscale='Viridis',
        line_width=1
    )
))

fig.show()
```

## 引用

有关更多信息和图表属性选项，请参阅[function reference for px.scatter()](https://plotly.com/python-api-reference/generated/plotly.express.scatter)或[https://plotly.com/python/reference/scatter/](https://plotly.com/python/reference/scatter/)或[https://plotly.com/python/reference/scattergl/](https://plotly.com/python/reference/scattergl/)。
